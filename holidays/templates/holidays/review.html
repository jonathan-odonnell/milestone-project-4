<!-- Extends base template and loads static files -->
{% extends "base.html" %}
{% load static %}

<!-- Content block start -->
{% block content %}
<!-- Container start -->
<section class="container-fluid p-4">
    <div class="row g-0">
        <!-- Heading start -->
        <div class="col-12 text-center">
            <h1 class="section-heading mb-3">Write Review</h1>
        </div>
        <!-- Heading end -->
        <!-- Form start -->
        <div class="col-12 col-md-10 col-lg-8 mx-auto">
            <form action="{% 'rating' %}" method="POST">
                {% csrf_token %}
                <!-- Rating stars start -->
                <p class="form-label mb-2">Rating</p>
                <div class="rating-stars mb-3">
                    <button class="btn shadow-none p-0 me-1" type="button" data-rating="1">
                        <i class="far fa-star fa-lg" aria-label="1 star"></i>
                    </button>
                    <button class="btn shadow-none p-0 me-1" type="button" data-rating="2">
                        <i class="far fa-star fa-lg" aria-label="2 stara"></i>
                    </button>
                    <button class="btn shadow-none p-0 me-1" type="button" data-rating="3">
                        <i class="far fa-star fa-lg" aria-label="3 stars"></i>
                    </button>
                    <button class="btn shadow-none p-0 me-1" type="button" data-rating="4">
                        <i class="far fa-star fa-lg" aria-label="4 stars"></i>
                    </button>
                    <button class="btn shadow-none p-0 me-1" type="button" data-rating="5">
                        <i class="far fa-star fa-lg" aria-label="5 stars"></i>
                    </button>
                </div>
                <!-- Rating stars end -->
                {{ form.rating | as_crispy_field }}
                {{ form.title | as_crispy_field }}
                {{ form.review | as_crispy_field }}
                <!-- Redirect URL hidden field. Code is from https://stackoverflow.com/questions/27325505/django-getting-previous-url -->
                {% if request.META.HTTP_REFERER %}
                <input type="hidden" name="redirect_url" value="{{ request.META.HTTP_REFERER }}" />
                {% endif %}
                <div class="mt-4 text-center">
                    <button class="btn btn-primary" type="submit">Add Review</button>
                </div>
            </form>
            <!-- Form end -->
        </div>
    </div>
</section>
<!-- Container end -->
{% endblock %}
<!-- Content block end -->

<!-- Postloadjs block start -->
{% block postloadjs %}
{{ block.super }}
<script>
    let rating = $('input[name="rating"]').val()
    $(document).ready(function() {
        $('#div_id_rating').addClass('d-none')
    })
    $('.rating-stars .btn').mouseenter(function () {
        $(this).prevAll().find('i').addClass('fas').removeClass('far')
        $(this).find('i').addClass('fas').removeClass('far')
        $(this).nextAll().find('i').addClass('far').removeClass('fas')
    })
    $('.rating-stars .btn').click(function () {
        $(this).prevAll().find('i').addClass('fas').removeClass('far')
        $(this).find('i').addClass('fas').removeClass('far')
        $(this).nextAll().find('i').addClass('far').removeClass('fas')
        $('input[name="rating"]').val($(this).data('rating'))
        rating = $('input[name="rating"]').val()
    })
    $('.rating-stars').mouseleave(function () {
        if (rating) {
            console.log(rating)
            $(this).find('i').slice(0, parseInt(rating)).addClass('fas').removeClass('far')
            $(this).find('i').slice(parseInt(rating), 5).addClass('far').removeClass('fas')
        } else {
            $(this).find('i').addClass('far').removeClass('fas')
        }
    })
</script>
{% endblock %}
<!-- Postloadjs block end -->