{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container-fluid p-4">
    <div class="row no-gutters">
        <div class="col-12 text-center">
            <h2 class="section-heading mb-3">Flights</h2>
        </div>
        <div class="col-12 col-lg-8 mx-auto">
            <div class="row g-0 mb-3">
                <div class="col-6 my-auto">
                    <a href="{% url 'add_flight' %}"><i class="fas fa-plus me-3"></i>Add
                        flight</a>
                </div>
                <div class="col-6 col-sm-4 col-lg-3 ms-auto ps-1">
                    <select id="flight-sort-selector" class="form-select shadow-none">
                        <option value="number_asc">Sort by: Flight Number (Low - High)</option>
                        <option value="number_desc">Flight Number (High - Low)</option>
                        <option value="origin_asc">Origin (A - Z)</option>
                        <option value="origin_desc">Origin (Z - A)</option>
                        <option value="destination_asc">Destination (A - Z)</option>
                        <option value="destination_desc">Destination (Z - A)</option>
                    </select>
                </div>
            </div>
            <div id="flights-table" class="g-0">
                {% include 'flights/includes/flights_table.html' %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block postloadjs %}
{{ block.super }}
<script>
    var currentUrl = new URL(window.location);
    $('#flight-sort-selector').change(function () {
        var selector = $(this);
        var currentUrl = new URL(window.location);

        var selectedVal = selector.val();
        if (selectedVal != "flight_number_asc") {
            var sort = selectedVal.split("_")[0];
            var direction = selectedVal.split("_")[1];

            currentUrl.searchParams.set("sort", sort);
            currentUrl.searchParams.set("direction", direction);
            currentUrl.searchParams.delete("page");
        } else {
            currentUrl.searchParams.delete("sort");
            currentUrl.searchParams.delete("direction");
        }
        $.get(currentUrl).done(function (data) {
            $('#flights-table').html(data.flights)
        })
    })
    $('#flights-table').on('click', '.page-link', function () {
        var page = $(this).data('page');
        currentUrl.searchParams.set("page", page);
        $.get(currentUrl).done(function (data) {
            $('#flights-table').html(data.flights)
        })
    })
</script>
{% endblock %}